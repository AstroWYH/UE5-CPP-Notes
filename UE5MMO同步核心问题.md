把 MMO 的同步方式整体捋一遍。

---

## 🎮 MMO 同步的核心问题

MMO 和 FPS 最大不同在于：

* **玩家数量巨大**（上千甚至上万人同时在线）。
* **延迟容忍度高**（100\~200ms 大多数 MMO 玩家能接受）。
* **带宽必须省**（否则服务器和客户端都会爆炸）。

所以 MMO 一般 **不会用预测 + 回滚**，而是用 **状态同步** + **插值/容错**。

---

## ⚙️ MMO 常见同步方式

### 1. **状态同步 (State Sync)**

* 服务器保存所有玩家和怪物的状态（位置、朝向、血量等）。
* 周期性（比如 100ms 一次）广播给客户端。
* 客户端收到后，用插值/平滑来过渡，避免“瞬移”。
  👉 **优点**：简单，保证服务器权威。
  👉 **缺点**：带宽大（上千人时压力极大）。

---

### 2. **差值同步 (Delta Sync)**

* 不广播完整状态，只广播“变化量”。
* 比如位置用 `上一次位置 + 偏移量`，动作只发“切换了哪个技能”。
  👉 节省带宽。

---

### 3. **兴趣管理 (Interest Management)**

* 服务器不会把全世界的状态都发给你，只发“你附近的对象”。
* 常见做法：AOI（Area of Interest），比如周围 50 米的玩家/怪物。
  👉 大幅减少无用数据。

---

### 4. **定点数/压缩同步**

* 位置/旋转不用 float（32 位），而是用定点数或更小的数据存储。
* 比如位置精度只保留到 0.1 米，就可以用 **16 位甚至 8 位** 来存储。
* **“8bit同步”很可能指的就是这种压缩：把坐标/动作/状态压缩到字节级别来传输**。
  👉 节省带宽，特别适合 MMO。

---

### 5. **客户端插值/平滑**

* 因为数据不是每帧都有，所以客户端用插值来“补帧”。
* 例如：服务器 10Hz（100ms 更新一次），客户端本地 60fps。

  * 客户端收到 A 点和 B 点，自己插值填充中间的 5 帧，让移动更流畅。
* 也可能加**容错机制**（比如玩家轻微卡顿时“纠偏”）。

---

## ✅ 总结

* **MMO 同步** = 服务器权威 + 周期性广播 + 客户端插值/平滑。
* 核心优化手段：**兴趣管理** + **差值同步** + **数据压缩**。
* **“8bit同步”** 很可能指 **把某些数据（如位置/动作）压缩到 8bit（1字节）来传输**，节省带宽。

  * 举例：角色方向只有 256 个可能值（360°/256 ≈ 1.4°），完全够用 → 就可以用一个 `uint8` 存。

---

## 🎯 1. MMO vs FPS 同步的核心差异

| 特性             | FPS / MOBA 等竞技游戏     | MMO (大规模在线)         |
| -------------- | -------------------- | ------------------- |
| **延迟容忍度**      | 极低，50ms 都可能影响手感      | 高，100\~200ms 玩家能接受  |
| **交互规模**       | 小规模（10\~20人以内）       | 大规模（上百上千人）          |
| **同步目标**       | 每个玩家的操作必须精确还原        | 主要保证结果一致即可，过程不必精确   |
| **常用方式**       | **帧同步 + 客户端预测 + 回滚** | **状态同步 + 插值 + 压缩**  |
| **CPU/GPU 开销** | 大部分算力用在预测和校正         | 大部分算力用在兴趣管理、状态广播和插值 |

👉 **FPS 强调“精确还原操作”**，
👉 **MMO 强调“状态一致 & 带宽可控”**。

---

## ⚙️ 2. 帧同步 vs 状态同步

### 🟢 帧同步（Lockstep / Input Sync）

* **做法**：

  * 客户端只上传输入（按键/操作）。
  * 服务器收集所有输入，在固定帧率（如 30Hz = 每 33ms 一帧）广播输入给所有人。
  * 每个客户端用相同逻辑模拟 → 理论上结果完全一致。

* **优点**：

  * 带宽小（只传输入）。
  * 客户端逻辑完全一致，公平性高。

* **缺点**：

  * 需要所有客户端**锁步**，有一个人延迟高就拖累全局。
  * 不适合上百人规模。

* **典型用法**：

  * MOBA（Dota、LOL 的早期版本）
  * RTS（星际争霸）

---

### 🔵 状态同步（State Sync）

* **做法**：

  * 服务器权威保存世界状态。
  * 周期性（如 100ms 一次）广播**关键对象的状态**（位置、血量、动画）。
  * 客户端根据状态做插值/平滑，填补中间帧。

* **优点**：

  * 容错性好（丢包、延迟不会卡死）。
  * 适合大规模玩家，带宽可控（配合 AOI/差值同步/压缩）。

* **缺点**：

  * 客户端和服务器中间的过程可能不同步（比如你看到人跑过去，其实他已经到达另一边）。
  * 操作手感依赖插值/预测。

* **典型用法**：

  * MMO（魔兽世界、FF14）
  * 开放世界（GTA Online）

---

## ⚠️ 3. 你说的 “30ms vs 100ms” 是区别吗？

* 不是单纯的“帧同步 30ms，一帧一次；状态同步 100ms，多帧一次”。
* **真正区别在于同步的内容**：

  * **帧同步**：每一帧同步**输入**，客户端自己算结果 → 周期通常固定（30Hz/60Hz）。
  * **状态同步**：同步的是**结果状态**，服务器多久发一次完全可以调整（20Hz、10Hz、甚至 5Hz），客户端用插值补帧。

👉 所以 MMO 不用每 30ms 广播一次（太费带宽），而是 100ms、200ms 一次广播，然后客户端平滑处理。
👉 FPS 必须尽量高频（20Hz\~60Hz），否则操作延迟太明显。

---

## ✅ 总结

* **帧同步**：同步输入，客户端自己算 → 适合小规模、低延迟、强对抗。
* **状态同步**：同步结果，客户端平滑插值 → 适合大规模、高延迟容忍度。
* **30ms vs 100ms**：不是绝对规则，而是 FPS 要求高频（30ms 一帧），MMO 可以低频（100ms 甚至更低）。



